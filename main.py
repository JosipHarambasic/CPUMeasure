import os
import time

import matplotlib.pyplot as plt
import psutil
from psutil import cpu_percent

from Parser import Parser

file = open("data.txt", "r")
mem = open("memory.txt", "r")
a = []
for i in file:
    a.append(i.strip()[24:30])
c = []
for i in a[1:-1]:
    c.append(float(i.replace(" ", "")))
#print(c)

m =[]
for i in mem:
    m.append(i.strip()[36:41])

memory = [1.3380828, 4.8205124, 8.4914013, 12.162340299999999, 13.9424044, 13.581256, 13.178555999999999, 13.198283, 14.099183, 14.501983000000001, 14.904683, 14.683556, 14.683556, 14.482256, 14.280856, 14.280856, 13.930109, 17.600997999999997, 17.600997999999997, 18.003698, 17.6974824, 14.821106399999998, 14.537106399999999, 14.537106399999999, 14.843321999999999, 14.683556, 14.3081998, 13.290202, 13.491602, 16.571281, 15.967181, 15.738436999999998, 13.286947000000001, 13.676756, 13.072655999999998, 13.274056, 13.527309, 13.527309, 16.996897999999998, 12.814809, 12.1951576, 13.852346599999999, 8.121489300000002, 7.8242179, 10.6047279, 4.5226605, 6.2261684, 7.1996094, 7.6277352, 10.2492137, 11.9234755, 15.3929645, 13.1782875, 16.2450765, 13.274056, 12.669955999999999, 12.721909, 12.721909, 13.124609, 12.721909, 11.6759466, 12.6115247, 12.1261247, 12.2088247, 10.7400451, 12.669955999999999, 12.468556, 10.857655999999999, 8.6554666, 6.6615236, 4.4464836000000005, 6.909182600000001, 7.4669936, 10.253556, 11.2732466, 12.729135600000001, 8.304689600000001, 9.156448600000001, 5.472659, 5.0699190000000005, 5.9201157, 6.3228557, 6.926955700000001, 10.3965247, 10.253556, 11.840076, 11.865858, 9.046678, 7.033008, 4.6925802, 3.8294930000000003, 4.232222999999999, 4.634963, 5.219336, 6.8302760000000005, 8.843945999999999, 11.761298, 13.976398, 13.124609, 13.326009, 13.6896466, 13.974835699999998, 13.773435699999999, 17.2429247, 13.3578451, 13.072655999999998, 13.475356, 13.072655999999998, 13.878155999999999, 13.9338205, 13.9338205, 13.9338205, 14.2539205, 14.280856, 13.191455999999999, 13.475356, 13.527309, 13.124609, 14.534209, 18.205098, 14.780235699999999, 14.6304981, 14.429098100000001, 14.429098100000001, 14.818907500000002, 16.476196500000004, 11.260356, 11.058955999999998, 14.528545000000001, 14.749572, 16.360572, 14.904683, 14.904683, 14.683556, 12.669955999999999, 9.883393, 7.4863290000000005, 7.4863290000000005, 9.701369, 13.372298]
do = [462.0, 1518.0, 2803.0, 3859.0, 4981.0, 6103.0, 7225.0, 8347.0, 9469.0, 10591.0, 11581.0, 12769.0, 14124.0, 15258.0, 16380.0, 17502.0, 18624.0, 19812.0, 21056.0, 22178.0, 23234.0, 24977.0, 26460.0, 27516.0, 28638.0, 29694.0, 31756.0, 32878.0, 34066.0, 35122.0, 36178.0, 37366.0, 38721.0, 39975.0, 41031.0, 42153.0, 43275.0, 44331.0, 45773.0, 47265.0, 48453.0, 49575.0, 50662.0, 51718.0, 52906.0, 54094.0, 55216.0, 57673.0, 59213.0, 60335.0, 61457.0, 62645.0, 64000.0, 64990.0, 66178.0, 67366.0, 68488.0, 69138.0, 69326.0, 70250.0, 71362.0, 72286.0, 73474.0, 74231.0, 74891.0, 75485.0, 76211.0, 76871.0, 77531.0, 78323.0, 79480.0, 80602.0, 81724.0, 82648.0, 83902.0, 85024.0, 86400.0, 87468.0, 88392.0, 89448.0, 90240.0, 91362.0, 92550.0, 93703.0, 94957.0, 96145.0, 97201.0, 98323.0, 99445.0, 100567.0, 101526.0, 102846.0, 103968.0, 105090.0, 106080.0, 107136.0, 108615.0, 109803.0, 110925.0, 112047.0, 113235.0, 114357.0, 115347.0, 118555.0, 119677.0, 121091.0, 122213.0, 123401.0, 124457.0, 125579.0, 126868.0, 127990.0, 129112.0, 130102.0, 131224.0, 132346.0, 133722.0, 134910.0]
upxmr,downxmr,upsensor,downsensor = Parser("nethogs.txt").parse()


#plt.plot(memory, label="Sent KB/s")
plt.title("Network Usage Difference between Sensor and XMRig")
plt.plot(upxmr, label="XMRig upload KB/s")
plt.plot(downxmr, label="XMRig download KB/s")
plt.plot(upsensor, label="Sensor upload KB/s")
plt.plot(downsensor, label="Sensor download KB/s")
plt.axvline(x=20, linestyle="dashed", color="red",ymax=0.97, label="attack started")
plt.axvline(x=120, linestyle="dashed", color="green",ymax=0.97, label="attack killed")
plt.xlabel("seconds")
plt.legend()
plt.ylabel("Kilo Bytes per Second")
plt.savefig("netdiff.png")